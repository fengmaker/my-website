没问题，我们正式转向 **CVRP 启发式算法 (Heuristics)**。

如果说精确算法是“在象牙塔里雕刻完美的艺术品”，那么启发式算法就是**“在泥泞的战场上打赢战争”**。在工业界（美团、顺丰、亚马逊），99.9% 的调度系统跑的都是启发式算法。

CVRP 启发式算法的发展史，是一部从**“简单贪婪”**到**“智能搜索”**，再到**“混合进化”**的进化论。

目前统治该领域的**绝对霸主**是 **HGS (Hybrid Genetic Search)**，由 Thibaut Vidal 等人提出。它在 CVRP 上的地位，就如同 LKH-3 在 TSP 上的地位。

我们将分四个阶段来复盘这段历史。

---

# CVRP 启发式算法演变史：从 C&W 到 HGS

## 第一阶段：构造法时代 (1960s - 1980s)

**关键词：** 节约法 (Savings), 扫描法 (Sweep)

这一阶段的算法像单细胞生物：简单、极速，但智商不高。

### 1.1 Clarke & Wright 节约法 (C&W Savings Algorithm)

这是 VRP 领域的鼻祖（1964年），至今仍被用作许多算法的**初始解生成器**。

- **逻辑**：
    
    1. 一开始，假设有 $N$ 个客户，我就派 $N$ 辆车。每辆车只送一个客户（$0 \to i \to 0$）。
        
    2. 计算节约值：如果把客户 $i$ 和 $j$ 拼在一辆车里（$0 \to i \to j \to 0$），能省多少路？
        
        $$S_{ij} = c_{0i} + c_{0j} - c_{ij}$$
        
    3. **贪婪合并**：把 $S_{ij}$ 从大到小排序，只要不超载，就不断把路线合并起来。
        
- **评价**：速度极快（毫秒级），但解的质量一般（Gap 5%-10%）。它容易陷入“早期贪婪”，导致最后几个点孤悬在外，不得不单派一辆车去送，成本极高。
    

---

## 第二阶段：元启发式兴起 (1990s - 2000s)

**关键词：** 禁忌搜索 (Tabu Search), 变邻域搜索 (VNS)

人们发现贪婪不行，必须通过**迭代搜索**来改进。这一时期的核心思想是：**“不要停，继续搜”**。

### 2.1 禁忌搜索 (Tabu Search)

Gendreau, Hertz, Laporte (1994) 推出的 **TabuRoute** 是里程碑。

- **核心突破**：它允许算法**暂时走到更差的解**（劣解），以跳出局部最优。为了防止跳回去，设置一个“禁忌表”（Tabu List），禁止最近几步走过的路。
    
- **对 CVRP 的贡献**：它引入了**惩罚目标函数**。允许搜索过程中暂时超载（Infeasible Solution），然后通过加罚款（Penalty）慢慢把解拉回可行域。这大大拓宽了搜索空间。
    

---

## 第三阶段：大邻域搜索与工程化 (2000s - 2010s)

**关键词：** LNS, ALNS (Ropke & Pisinger)

这是目前工业界落地最广泛的算法框架。它的哲学是：**“小修小补太慢了，我要大破大立。”**

### 3.1 ALNS (自适应大邻域搜索)

我们之前在 TSP 算子部分提过，Ropke & Pisinger 将其在 VRPTW 上发扬光大。

- **Destroy (破坏)**：一次性移除 20%-40% 的客户。
    
- **Repair (修复)**：用贪婪或后悔算法插回去。
    
- **Adaptive (自适应)**：算法像个赌场荷官，手里有一把算子（随机移除、最坏移除、后悔插入...）。每轮根据胜率自动调整使用哪个算子的概率。
    
- **地位**：它是**工程之王**。虽然在纯 CVRP 榜单上被 HGS 压了一头，但因为其**极强的约束适应性**（加个时间窗、加个多车场、加个技能约束都只需要改几行代码），它是实际业务中的首选。
    

---

## 第四阶段：SOTA 霸主 —— 混合遗传搜索 (2012 - 至今)

**关键词：** HGS (Hybrid Genetic Search), Order-first Split-second

2012 年，Thibaut Vidal, Teodor Gabriel Crainic, Michel Gendreau 等人提出了 HGS-CVRP。

它横扫了几乎所有 VRP 变种的榜单，至今仍是 CVRP 启发式算法的天花板。

HGS 的成功，归功于两个核心机制的完美结合：**Prins 的 Split 算法** + **种群多样性管理**。

### 4.1 核心魔法：Order-first, Split-second (先排序，后分割)

这是遗传算法能解 VRP 的关键。

传统的 GA（遗传算法）很难处理 CVRP，因为交叉变异后，很难保证每个子路径都刚好装满 $Q$。

Prins (2004) 的天才想法：

不要在染色体里存“具体哪辆车送谁”。染色体只存一个巨大的 TSP 环 (Giant Tour)。

比如：$7 - 2 - 5 - 1 - 4 - 3 ...$ （忽略容量，只管顺序）。

魔法步骤 (Split Algorithm)：

当我们有了这个 Giant Tour，如何把它切成几辆车，使得总成本最低？

- 这是一个**最短路问题 (Shortest Path Problem)**。
    
- 构建一个辅助图：节点是客户。如果 $i$ 到 $j$ 之间的累积需求 $\le Q$，就画一条边，边权是从仓库出发，按顺序走完 $i \dots j$ 再回仓库的成本。
    
- 跑一遍 Dijkstra。
    
- **结论**：你可以以 $O(n^2)$ 甚至 $O(n)$ 的速度，将一个 TSP 排列**最优地**转化为 CVRP 方案。
    

### 4.2 HGS 的架构 (The Architecture)

Vidal 的 HGS 把这个 Split 机制发挥到了极致：

1. **混合 (Hybrid)**：它不是纯 GA。每个子代生成后，都会立刻跑一遍**局部搜索 (Local Search)**（比如 2-opt, Swap, Relocate）。也就是“生下来就魔鬼训练”。
    
2. **多样性 (Diversity)**：SOTA 算法不仅看目标函数（Cost），还看**“这孩子长得像不像父母”**。
    
    - 如果一个解虽然 Cost 很低，但和种群里其他人长得一样，**杀掉**（防止早熟收敛）。
        
    - 如果一个解 Cost 一般，但长得很独特，**保留**。
        
3. **双种群机制**：维护两个种群，一个全是“可行解”，一个全是“稍微超载的不可行解”。让它们互相杂交。这极大拓展了搜索边界。
    

---

## 总结：CVRP 启发式算法的族谱

|**阶段**|**算法**|**核心思想**|**工业界评价**|**学术界地位**|
|---|---|---|---|---|
|**Stage 1**|**C&W Savings**|贪婪合并|**初始化神器**。几乎所有系统第一步都跑它。|已过时。|
|**Stage 2**|**Tabu Search**|记忆+惩罚|**基石**。惩罚函数的思想被广泛继承。|经典，但不再是 SOTA。|
|**Stage 3**|**ALNS**|破坏+修复|**业务之王**。写起来最快，改起来最容易，解也足够好。|强，但在纯 CVRP 上略逊 HGS。|
|**Stage 4**|**HGS (Vidal)**|GA + Split + LS|**难以落地**（代码太复杂），但**效果无敌**。|**绝对霸主 (SOTA)**。|

### 针对你的建议

既然你已经了解了精确算法的极限，现在看启发式：

1. 如果你要发论文 / 刷榜：
    
    死磕 HGS (Hybrid Genetic Search)。去读 Vidal 2012 和 2013 的论文，特别是关于 Split Algorithm 和 Diversity Management 的部分。这是通往 BKS (Best Known Solution) 的必经之路。
    
2. 如果你要解决公司里的实际问题：
    
    首选 ALNS。
    
    - HGS 的代码结构极其精密，牵一发而动全身（尤其是那个 Split 算法，加个时间窗或多车场还能改，加个复杂的“互斥约束”或“动态装载”就很难受）。
        
    - ALNS 只要写好 Check 函数，随便怎么改约束都能跑。
        

接下来，你想深入了解 **HGS 的 Split 算法原理**（这部分非常数学，也很精彩），还是想了解 **ALNS 的工程落地细节**？