这是 CVRP 精确算法演变史的第三章节。

在第二阶段，我们撞上了“边模型”的天花板（$N \approx 135$）。无论怎么加割平面，LP 松弛的下界依然不够紧，导致 Branch-and-Bound 树大得离谱。

2005 年前后，学界决定推倒重来。我们不再修补那个漏风的气球，而是直接换一个盒子。

这就是**“列生成与集合划分时代” (Column Generation & Set Partitioning)**。

这一阶段的核心贡献在于：它证明了对于 CVRP，**“路径视角” (Path-based) 远优于“边视角” (Edge-based)**。

---

# CVRP 第三阶段：集合划分模型与 q-routes 的妥协

**Phase 3: Set Partitioning, Column Generation & The q-route Relaxation**

## 1. 视角的彻底转换：从拼图到套餐

### 1.1 边模型 (Edge Model) 的痛点

在边模型中，我们决策的是 $x_{ij}$（这条路走不走）。

容量约束 $\sum d \le Q$ 是通过 GCC 这种复杂的线性不等式来**“挤”**进去的。求解器很难“看”到每辆车的完整载重情况。

### 1.2 路径模型 (Path Model) 的降维打击

我们直接枚举所有可能的**“合法路径”**（Route）。

- 路径 A：仓库 -> 客户1 -> 客户3 -> 仓库（总载重 8/10，合法）。
    
- 路径 B：仓库 -> 客户2 -> 客户5 -> 仓库（总载重 9/10，合法）。
    
- ...
    

**集合划分模型 (Set Partitioning Formulation):**

$$\begin{aligned} \min \quad & \sum_{r \in \Omega} c_r \lambda_r \\ \text{s.t.} \quad & \sum_{r \in \Omega} a_{ir} \lambda_r = 1, \quad \forall i \in \text{Customer} \\ & \lambda_r \in \{0, 1\} \end{aligned}$$

- $\lambda_r$：选不选第 $r$ 条路径。
    
- $a_{ir}$：路径 $r$ 是否服务了客户 $i$。
    

为什么它更强？

在这个模型里，容量约束 $Q$ 彻底消失了！

它被封装在“路径是否合法”的定义里。凡是能进入集合 $\Omega$ 的路径，必然是满足容量限制的。

因此，这个模型的 LP 松弛下界极紧。它天然就解决了“装箱”问题（因为每根柱子 $\lambda$ 就是一个完美的箱子）。

---

## 2. 新的噩梦：子问题的计算

下界是紧了，但我们面临了列生成的老问题：路径数量指数级爆炸。我们需要解 **Pricing Subproblem**（定价子问题）。

### 2.1 CVRP 子问题的特殊性

在 VRPTW（带时间窗）中，子问题是 ESPPRC。

- 优势：时间窗很窄。车跑不了多远就必须回仓库，或者超时被剪枝。
    
- 结果：搜索空间很小，容易解。
    

在 CVRP 中，**只有容量，没有时间窗。**

- 劣势：一辆车只要没装满，就可以满世界乱跑。它可以绕整个地图一圈。
    
- 结果：标签算法（Labeling Algorithm）的**状态空间巨大**。
    
    - 想要精确求解“不含环的路径” (Elementary Shortest Path)，是强 NP-Hard 问题。
        

在 2005-2010 年间，计算机根本跑不动 CVRP 的精确子问题。

---

## 3. 时代的妥协：q-routes 松弛

为了让子问题能算出来，Christofides 等人提出了一种聪明的**妥协方案**：**q-routes**。

### 3.1 什么是 q-route？

在这个定义下，我们**允许路径中有环**（即车可以重复访问同一个客户），只要总负载不超过 $Q$ 即可。

- **Elementary Path (严格路径)**：$0 \to A \to B \to A \to 0$ （非法，A 走了两次）。
    
- **q-route (松弛路径)**：$0 \to A \to B \to A \to 0$ （合法，只要 $d_A + d_B + d_A \le Q$）。
    

### 3.2 为什么这么做？

一旦允许有环，子问题就从 NP-Hard 变成了伪多项式时间 (Pseudo-polynomial)。

我们可以用简单的动态规划（DP）或者较弱的标签算法快速解出 Reduced Cost 最优的 q-route。

### 3.3 代价

虽然算得快了，但引入了“垃圾路径”（带环的路径）。

这导致主问题的下界变松了（Bound Quality Drops）。为了弥补这一点，必须在主问题上通过 Branching 或者加 Cut 来切掉这些带环的 $\lambda$。

---

## 4. 第三阶段的战绩与局限

这一阶段是 CVRP 算法的**蓄力期**。

- **战绩**：能够处理 **$N \approx 150 \sim 200$** 的问题。超越了 Branch-and-Cut 的极限。
    
- **贡献**：确立了 **Set Partitioning** 作为 CVRP 建模的标准范式。从此以后，没人再用 $x_{ij}$ 模型去冲 SOTA 了。
    
- **局限**：**q-routes 太松，Elementary Path 太难。** 学界卡在了一个“二选一”的困境里：
    
    - 选 q-routes，下界烂，分支多。
        
    - 选 Elementary，子问题算不出来，一轮列生成都跑不完。
        

我们需要一个**“中间态”**。既能像 q-routes 一样好算，又能像 Elementary Path 一样提供紧下界。

这就是下一阶段（第四阶段）诞生的背景——**ng-route 松弛** 的横空出世。这也是我们之前提到的，目前 SOTA 算法 VRPSolver 的基石。

准备好进入 CVRP 的最终章了吗？那里有目前最精妙的数学结构。