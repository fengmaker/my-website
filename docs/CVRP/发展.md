这是一个非常好的切入点。

**CVRP (Capacitated Vehicle Routing Problem, 容量限制车辆路径问题)** 是 VRP 家族的老祖宗。它比 TSP 只多了一个约束：**容量 (Capacity, $Q$)**。

但就是这一个 $Q$，让精确算法的演变历史发生了与 TSP **完全不同**的转向。

如果说 TSP 的终局是 **Concorde (Branch-and-Cut)**，那么 CVRP 的终局则是 **VRPSolver (Branch-Cut-and-Price)**。

我们将 CVRP 精确算法的演变史分为三个纪元，见证“切割派”与“列生成派”的百年战争。

---

# CVRP 精确算法演变史：从 B&C 到 BCP 的权力交接

## 第一纪元：紧致模型与基础割平面 (1960s - 1990s)

**关键词：** 两个下标模型、广义容量约束 (GCC)

早期的学者试图照搬 TSP 的成功经验。既然 TSP 用 MTZ 或 DFJ 能解，那 CVRP 不就是加个 $\sum d_i \le Q$ 吗？

### 1.1 经典模型：双下标流模型 (Two-Index Flow Formulation)

Laporte 等人提出，决策变量依然是 $x_{ij}$。

区别在于，TSP 的子回路消除约束（SECs）变成了广义容量约束 (Generalized Capacity Constraints, GCCs)。

GCC 公式：

对于任意客户子集 $S \subseteq V_c$，进出该集合的车辆数，必须足以搬空里面的货物。

$$\sum_{i \in S, j \notin S} x_{ij} \ge 2 \times \lceil \frac{\sum_{k \in S} d_k}{Q} \rceil$$

- $\sum_{k \in S} d_k$：集合 $S$ 的总需求。
    
- $\lceil \dots \rceil$：向上取整。比如需求总和是 15，车容量是 10，那你至少需要 $\lceil 1.5 \rceil = 2$ 辆车进出。
    

### 1.2 为什么失败了？

这个模型在 $N > 50$ 时就崩了。

- **原因**：线性规划松弛（LP Relaxation）对“容量”这个概念非常迟钝。Bin Packing（装箱）结构的下界在 Edge-based 模型中极差。
    
- **结论**：直接在 $x_{ij}$ 上加约束，搞不定容量问题。
    

---

## 第二纪元：Branch-and-Cut 的巅峰 (1990s - 2004)

**关键词：** Lysgaard (2004), 强化容量割, 梳状不等式的迁移

在 2004 年，CVRP 的 Branch-and-Cut 达到了顶峰，代表作是 **Lysgaard, Letchford, Eglese (2004)** 的算法。这相当于 CVRP 界的 Concorde。

### 2.1 核心思路

既然基础的 GCC 不够紧，那就疯狂加强它。这一时期发明了大量针对 CVRP 的特有割平面：

1. **FCC (Framed Capacity Cuts)**：把容量约束和背包问题结合起来切。
    
2. **Strengthened Comb Cuts**：把 TSP 的梳状不等式改造，使其适应多车的情况。
    
3. **Multistar Cuts**：针对某个点周围的放射状结构进行切割。
    

### 2.2 历史地位与瓶颈

- **成就**：能解 $N=100 \sim 135$ 的问题。
    
- **死穴**：当问题是“紧容量” (Tight Capacity，即 $\sum d \approx m \times Q$) 时，B&C 表现还行（因为像装箱问题）。但当问题主要是**路由优化**时，下界提升太慢。
    
- **结论**：Branch-and-Cut 在 CVRP 上遇到了天花板，无法像在 TSP 上那样大杀四方。
    

---

## 第三纪元：列生成的崛起 (2005 - 2010)

**关键词：** Set Partitioning, q-routes, 基础列生成

随着计算机内存的增加，**集合划分模型 (Set Partitioning)** 开始登上舞台。

### 3.1 模型的彻底转型

不再纠结 $x_{ij}$，直接枚举路径 $\lambda_r$。

$$\min \sum c_r \lambda_r \quad \text{s.t.} \sum a_{ir} \lambda_r = 1$$

这个模型的 LP 松弛下界，天然就比 Edge-based 模型紧得多！因为它隐含了“每条路径必须满足容量 $Q$”这个硬约束。

### 3.2 早期的子问题难题

在 VRPTW 中，时间窗能帮我们要剪枝（去晚了就死）。

但在 CVRP 中，没有时间窗，只有容量。这意味着一辆车可以跑很久、跑很远，标签算法（Labeling Algorithm）的搜索空间巨大，很难收敛。

- **过渡方案**：早期使用 **q-routes** 松弛。允许路径中有环，只要总需求 $\le Q$ 即可。这虽然好算，但下界质量受损。
    

---

## 第四纪元：现代 BCP 与 SOTA 的诞生 (2011 - 至今)

**关键词：** ng-routes, Rank-1 Cuts, VRPSolver

这是 CVRP 历史上的奇点。

2011 年，Baldacci, Mingozzi, Roberti 发表了划时代的论文，引入了 ng-route 松弛。

2020 年，Pessoa 等人集大成，发布了 VRPSolver。

### 4.1 核心突破一：ng-route 松弛

这是解决 CVRP 子问题“太难算”和“下界太松”矛盾的完美平衡点。

- **机制**：给每个点设一个“记忆集”。离开这个区域就“失忆”。
    
- **效果**：它消除了大部分短环（A-B-A），保留了长环。使得 CVRP 的子问题终于可以用标签算法在毫秒级解出。
    

### 4.2 核心突破二：Rank-1 Cuts (Subset-Row Cuts)

这是 BCP 能够超越 B&C 的核武器。

- **问题**：在列生成的主问题上加割平面（Cut），通常会破坏子问题结构。
    
- **创新**：Pessoa 等人发现了一类特殊的割平面（Limited Memory Rank-1 Cuts）。加了它之后，**子问题依然是标准的 ESPPRC，只需要修改边权即可！**
    
- **意义**：这意味着我们可以同时享受“列生成的高下界”和“割平面的切割能力”。**Branch-Cut-and-Price (BCP)** 正式合体。
    

### 4.3 核心突破三：双向标签与自动化 (Bi-directional Labeling)

- 既然 CVRP 路径长，那就**两头往中间搜**。
    
- VRPSolver 实现了高度自动化的 Bucket Graph Labeling，是目前解 CVRP 子问题的速度天花板。
    

---

## 总结：CVRP 精确算法演变路线图

|**时期**|**主流方法**|**核心技术**|**解决规模 (N)**|**评价**|
|---|---|---|---|---|
|**1980s**|**Compact Models**|2-Index Flow + GCC|$< 50$|仅仅是把 TSP 模型拿来硬改，效果很差。|
|**2000s**|**Branch-and-Cut**|Lysgaard Cuts (FCC, Multistar)|$100 \sim 135$|CVRP 界的“Concorde 尝试”，但受限于容量约束的非线性特征，最终败下阵来。|
|**2010s**|**Branch-and-Price**|Set Partitioning + q-routes|$150 \sim 200$|发现了 Set Partitioning 的下界优势，但子问题求解困难。|
|**2020s**|**Branch-Cut-and-Price**|**ng-routes + Rank-1 Cuts**|**300 ~ 500+**|**当前 SOTA (VRPSolver)**。列生成与割平面的完美融合。|

**给您的教学建议：**

讲 CVRP 的历史，实际上就是讲**“为什么 Branch-and-Cut 输给了 Branch-Cut-and-Price”**的故事。

- 在 TSP 中，结构单一，Cut 能切到底，所以 B&C 赢了。
    
- 在 CVRP 中，容量约束导致组合爆炸，Edge 模型表达能力不足，必须通过 Set Partitioning (Path 模型) 来处理，所以 BCP 赢了。
    

接下来，我们可以深入看 **ng-route** 到底是什么神仙操作，或者是 **CVRP 的标签算法**和 VRPTW 有什么本质不同？