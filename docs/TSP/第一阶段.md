# 运筹学精确算法专题一：旅行商问题的紧致模型演进

**Topic 1: Exact Algorithms for TSP - The Evolution of Compact Formulations**

## 1. 问题背景与数学定义 (Problem Definition)

旅行商问题 (Traveling Salesman Problem, TSP) 是组合优化领域最著名的 NP-Hard 问题之一。它不仅在物流配送、芯片制造等领域有广泛应用，更是检验整数规划算法优劣的“试金石”。

数学定义：

给定一个完全有向图 $G = (V, A)$，其中 $V = \{1, 2, ..., n\}$ 为城市集合，节点 $1$ 通常定义为仓库（Depot）。$A$ 为弧集，每一条弧 $(i, j)$ 具有非负成本 $c_{ij}$。

我们的目标是寻找一条经过每个城市恰好一次并返回起点的回路，使得总成本最小。

**决策变量：**

$$x_{ij} = \begin{cases} 1, & \text{若车辆从城市 } i \text{ 直接前往 } j \\ 0, & \text{否则} \end{cases}$$

---

## 2. 初始尝试：指派问题模型 (The Assignment Relaxation)

在引入消除子回路约束之前，我们首先建立一个朴素模型。该模型仅包含“流平衡”或“度数”约束。

### 2.1 模型构建

$$\begin{aligned} \min \quad & \sum_{i \in V} \sum_{j \in V, j \neq i} c_{ij} x_{ij} \\ \text{s.t.} \quad & \sum_{j \in V, j \neq i} x_{ij} = 1, \quad \forall i \in V \quad (\text{出度约束}) \\ & \sum_{i \in V, i \neq j} x_{ij} = 1, \quad \forall j \in V \quad (\text{入度约束}) \\ & x_{ij} \in \{0, 1\} \end{aligned}$$

### 2.2 模型的缺陷：子回路 (Subtours)

上述模型等价于**指派问题 (Assignment Problem)**。虽然指派问题是多项式时间可解的（如使用匈牙利算法），但其最优解往往不构成单一的哈密顿回路 (Hamiltonian Cycle)。

- **现象：** 求解器可能会输出多个不相连的独立回路（例如：$1 \to 2 \to 3 \to 1$ 和 $4 \to 5 \to 6 \to 4$）。
    
- **结论：** 必须引入**子回路消除约束 (Subtour Elimination Constraints, SECs)** 来强制连通性。
    

---

## 3. 几何视角：DFJ 模型 (Dantzig-Fulkerson-Johnson)

该模型由 George Dantzig 等人于 1954 年提出，是从多面体几何角度切入的经典之作。

### 3.1 核心逻辑

为了消除子回路，DFJ 规定：对于任意一个非空的城市真子集 $S$ ($S \subset V, 2 \le |S| \le n-1$)，其内部的边数不能足以构成一个回路。即子集 $S$ 内部最多只能有 $|S|-1$ 条边。

### 3.2 数学表达

$$\sum_{i \in S} \sum_{j \in S, j \neq i} x_{ij} \le |S| - 1, \quad \forall S \subset V, 2 \le |S| \le n-1$$

或者等价地使用**割集 (Cut-set)** 形式（即离开子集 $S$ 的边至少有一条）：

$$\sum_{i \in S} \sum_{j \notin S} x_{ij} \ge 1, \quad \forall S \subset V, 2 \le |S| \le n-1$$

### 3.3 理论评价

- **多面体强度 (Polyhedral Strength)：** DFJ 约束定义了 TSP 多面体的刻面 (Facets)。这意味着其**线性松弛 (Linear Relaxation)** 非常紧致，下界质量极高。在 Branch-and-Bound 搜索中，优秀的下界能大幅剪枝。
    
- **计算复杂性：** 约束数量呈指数级爆炸 ($2^n$)。
    
    - 对于 $n=100$，约束数量远超计算机内存限制。
        
- **现代解法：** 在实际应用中，我们不预先添加所有 DFJ 约束，而是采用 **行生成 (Row Generation)** 或 **Lazy Constraints** 技术，仅在发现违规子回路时动态添加对应约束。
    

---

## 4. 代数视角：MTZ 模型 (Miller-Tucker-Zemlin)

为了克服 DFJ 约束过多的问题，C.E. Miller 等人于 1960 年提出了基于“势能”或“次序”的紧致模型。

### 4.1 核心逻辑

引入辅助变量 $u_i$ 表示车辆访问城市 $i$ 的**次序**（或时间戳）。我们规定：如果车辆从 $i$ 走到 $j$，则 $j$ 的次序必须大于 $i$。由于回路意味着 $u_i < u_{i+1} < ... < u_i$，这在数学上是不可能的（除非回到起点），从而消除了所有不包含起点的子回路。

### 4.2 数学表达

引入连续变量 $u_i \in \mathbb{R}$ (通常 $1 \le u_i \le n$)，其中 $u_1 = 1$ (起点次序固定)。

对于所有 $i, j \in V \setminus \{1\}, i \neq j$：

$$u_i - u_j + n \cdot x_{ij} \le n - 1$$

_(注：这里的 $n$ 是 Big-M 系数，严格来说可以缩紧为 $n-1$)_

### 4.3 逻辑推导 (Proof of Correctness)

该约束利用了 **Big-M** 逻辑：

1. **激活状态 ($x_{ij}=1$)：**
    
    $$u_i - u_j + n \le n - 1 \implies u_i - u_j \le -1 \implies u_j \ge u_i + 1$$
    
    这强制了次序的递增性，符合物理事实。
    
2. **松弛状态 ($x_{ij}=0$)：**
    
    $$u_i - u_j \le n - 1$$
    
    由于 $u$ 的最大跨度不会超过 $n-1$，该不等式恒成立，不产生任何限制。
    

### 4.4 理论评价

- **计算复杂性：** 约束数量为 $O(n^2)$ 多项式级别。对于 $n=50$ 左右的问题，可以直接输入求解器求解。
    
- **多面体强度：** **弱 (Weak)**。
    
    - 由于引入了 Big-M 系数（$n$），当进行线性松弛时（$x_{ij}$ 取小数），$u_i$ 变量与 $x_{ij}$ 的耦合非常松散。这导致松弛解的下界质量远不如 DFJ，求解器需要更多的分支 (Branching) 才能收敛。
        

---

## 5. 总结与对比 (Comparison)

在教学中，可用下表总结两种模型的权衡：

|**维度**|**DFJ 模型 (Subtour Elimination)**|**MTZ 模型 (Potential/Indexing)**|
|---|---|---|
|**建模思路**|几何切割 (针对集合)|代数排序 (针对节点)|
|**约束数量**|指数级 $O(2^n)$|多项式级 $O(n^2)$|
|**LP 松弛质量**|**极强 (Tight)**|**较弱 (Loose)**|
|**求解难度**|无法直接求解，需配合 Branch-and-Cut|小规模可直接求解，大规模难以收敛|
|**工业地位**|现代高性能求解器的基石|教学演示、特定变种问题|

**教学建议 (Teaching Note)：**

- **初学者：** 推荐先从 MTZ 上手，因其代码实现简单，能直观看到结果。
    
- **进阶者：** 必须理解 DFJ，因为它是后续学习 **Branch-and-Cut** 和 **列生成 (Column Generation)** 算法思想的源头——即“**只处理那些被破坏的约束**”。
    

---

### 6. 课后思考题 (Assignments)

1. **MTZ 的改进：** 既然 MTZ 的弱点在于 Big-M，文献中是否有针对 MTZ 的强化约束？(提示：搜索 Desrochers and Laporte (1991) 的改进模型)。
    
2. **代码实战：** 使用 Python 调用 Gurobi/Cplex，分别实现 DFJ (利用 Lazy Callback) 和 MTZ 模型，并对比 $n=20$ 时两者的求解时间及 Root Node Gap。