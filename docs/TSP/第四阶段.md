这是一个专注于 **Concorde 架构** 与 **梳状不等式 (Comb Inequalities)** 的深度教学章节。

这一章节代表了目前人类解决 TSP 问题的最高水平。我们将剥离所有基础铺垫，直接进入数学核心，剖析那些让普通 Branch-and-Cut 束手无策的“顽固分数解”是如何被 Concorde 绞杀的。

---

# 运筹学精确算法专题四：SOTA 巅峰 —— Concorde 架构与梳状不等式

**Topic 4: State-of-the-Art Exact TSP - The Concorde Architecture & Comb Inequalities**

## 1. 引言：Concorde 的统治地位

Concorde TSP Solver 是由 Applegate, Bixby, Chvátal 和 Cook 四位数学家联合开发的求解器。它不是单一的算法，而是一个集成了近 50 年来组合优化领域所有“核武器”的复杂系统。

核心逻辑差异：

普通算法（Stage 2）只能切掉**“不连通的解”（Subtour）。

Concorde（Stage 4）能切掉“连通但非整数的解”**（Fractional Structure）。它主要针对的是那些由 0.5 构成的、满足度数约束、且连通的“伪装者”。

---

## 2. 数学核心：梳状不等式 (Comb Inequalities)

这是 Concorde 区别于普通求解器的决定性武器。要理解它，必须先理解为什么 DFJ（子回路消除）会失效。

### 2.1 顽固的“分数环”

假设求解器给出了一个由 0.5 组成的环状结构（如下图所示的 Comb 结构）。

- **度数检查**：每个点连接两条 0.5 的边，度数 $= 0.5 + 0.5 = 1.0$（假设归一化后）。
    
- **连通性检查**：图是连通的，没有任何割集的流量 $< 1$。
    
- **结论**：DFJ 约束对此无能为力。
    

我们需要一种新的几何结构来识别这种非整数性。

### 2.2 梳子结构定义 (The Comb Structure)

一个“梳子”由两个核心部分组成：

1. **梳把 (Handle, $H$)**：一个非空节点集合。
    
2. **梳齿 (Teeth, $T_1, \dots, T_k$)**：$k$ 个节点集合。
    

**严格的拓扑约束：**

1. **奇数性**：梳齿的数量 $k$ 必须是 $\ge 3$ 的**奇数**。
    
2. **相交性**：每个梳齿 $T_i$ 必须与梳把 $H$ **相交**，但又不能完全在 $H$ 里面。
    
    - $T_i \cap H \neq \emptyset$ （咬住梳把）
        
    - $T_i \setminus H \neq \emptyset$ （露在外面）
        
3. **不相交性**：梳齿之间互不相交。
    

### 2.3 不等式推导

对于任何合法的 TSP 整数巡回（Integer Tour），以下不等式恒成立：

$$x(E(H)) + \sum_{i=1}^k x(E(T_i)) \le |H| + \sum_{i=1}^k (|T_i| - 1) - \lceil \frac{k}{2} \rceil$$

- $x(E(S))$：表示集合 $S$ 内部所有边的 $x$ 值之和。
    
- **物理意义**：左边是梳把和梳齿内部被选中的边数；右边是理论上的整数上界。
    

为什么它能切掉分数解？

想象一个简单的梳子：梳把 $H$ 有 3 个点，挂着 3 个梳齿 $T_1, T_2, T_3$。

假设求解器给出的 $x$ 全部是 0.5。

- 代入公式左边，由于 0.5 填充了连接处，算出来的总和往往会比右边大 **0.5**。
    
- 这微小的 0.5 差距，就是切平面的“刀刃”，它将这个完美平衡的 0.5 分数解直接切除。
    

---

## 3. 算法架构：Concorde 的 Pipeline

Concorde 不仅仅是加几个不等式，它的工业级流程极其严密。

### 3.1 预处理：缩减问题规模 (Problem Reduction)

在进入分支定界之前，Concorde 会先“杀”死一部分变量。

- **工具**：LKH 启发式算法。
    
- **逻辑**：
    
    1. LKH 极快地跑出一个上界 $UB$（比如路径长度 1000）。
        
    2. 计算每个变量 $x_{ij}$ 的 **Reduced Cost (折算成本)** $RC_{ij}$。
        
    3. **判定**：如果 $LB + RC_{ij} > UB$，那么边 $x_{ij}$ **绝对不可能**出现在最优解中。
        
    4. **动作**：直接将 $x_{ij}$ 永久置为 0（从图中删除）。
        
    
    - _效果：对于大规模问题，这一步能删掉 90% 以上的边，极大地稀疏化图矩阵。_
        

### 3.2 核心循环：切割平面池 (Cutting Plane Loop)

这是 Concorde 最耗时的部分。它并不只是寻找梳状不等式，而是按优先级调用一系列**分离算法 (Separation Routines)**：

1. **Subtour Cuts** (基础)：使用 Min-Cut 算法。
    
2. **2-Matching Cuts (Blossom)**：利用 Padberg-Rao 算法寻找违背的 Blossom 不等式。
    
3. **Comb Inequalities** (进阶)：
    
    - 由于寻找通用的 Comb 是 NP-Hard 的，Concorde 使用启发式搜索。
        
    - 它通过**原子分解 (Atom Decomposition)** 寻找可能构成梳子的组件。
        
4. **Domino Parity Cuts** (SOTA 级)：
    
    - 比 Comb 更复杂的结构，形似多米诺骨牌。用于处理 Comb 切不掉的极端情况。
        

### 3.3 分支策略：强分支 (Strong Branching)

当切平面加不动了，必须分支时，Concorde 拒绝随机选择。

- **策略**：从小数解中挑选一组候选变量（比如 10 个最接近 0.5 的边）。
    
- **试探**：对每个候选变量，试着做一次“假分支”（跑几步单纯形法）。
    
- **决策**：选择那个能让**目标函数下界提升最大**的变量进行真正的分支。
    

---

## 4. 逻辑性与数学性梳理 (Summary of Logic)

为了教学严谨性，我们将 Concorde 的求解逻辑抽象为以下数学归纳：

1. 松弛 (Relaxation)：
    
    TSP 多面体 $P_{TSP}$ 太难描述。我们先求解其松弛版本 $P_{Subtour}$（仅包含度数和子回路约束）。
    
    $$P_{TSP} \subset P_{Comb} \subset P_{Subtour}$$
    
2. 紧致化 (Tightening)：
    
    当 LP 解 $x^*$ 位于 $P_{Subtour}$ 内部但不在 $P_{TSP}$ 内部时，它往往呈现出 Half-Integer (半整数) 特征（即由 0, 0.5, 1 构成）。
    
    Chvátal-Gomory 切割原理 告诉我们，这些解可以通过奇偶性约束（如 Comb）来分离。
    
3. 搜索 (Search)：
    
    由于 $P_{TSP}$ 的刻面极其复杂，我们无法一次性添加所有约束。Concorde 采用 Separation Oracle 模式：
    
    $$\text{Find } \alpha x \le \beta \text{ such that } \alpha x^* > \beta \text{ and } \forall x \in P_{TSP}, \alpha x \le \beta$$
    
    这个 Oracle 的实现质量，决定了求解器的速度。
    

---

## 5. 教学建议：如何讲解这一阶段

在向学生或读者讲解 Concorde 时，建议遵循以下步骤以保持逻辑链条的完整：

1. 从“图”到“多面体”的视角转换：
    
    不要再讲“修路”了。要讲“高维空间中的多面体切割”。Concorde 的本质就是不断地用超平面去切掉 LP 松弛解的“角”。
    
2. 强调 0.5 的特殊性：
    
    Comb Inequalities 的本质是利用奇数 ($k \ge 3$) 个齿，制造出一个 $0.5 \times \text{Odd}$ 的余数，从而打破整数边界。这是数学上的精妙之处。
    
3. LKH 的重要性：
    
    必须强调，没有 LKH 提供的极强上界，Concorde 的分支定界树会无限膨胀。这是启发式算法辅助精确算法的经典案例。
    

这一部分内容涵盖了 TSP 精确求解的最终形态。逻辑上是否足够清晰？